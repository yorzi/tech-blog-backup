
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>@yorzi</title>
  <meta name="author" content="Andy Wang">

  
  <meta name="description" content="I found a cool gem called &#8220;cheat&#8221;, it&#8217;s pretty handy and convenient when you wanna see a brief help/introduction of some &#8220; &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://yorzi.github.com/blog/page/8/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="@yorzi" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-17239385-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/" style="color:red">@yorzi</a></h1>
  
    <h2>great people share knowledge</h2>
  
  <a href="https://github.com/yorzi/yorzi.github.com"><img style="position: absolute; top: 0; right: 0; border: 0;" src="/images/forkme.png" alt="Fork me on GitHub"></a>
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss email">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
    <li><a href="wangyaodi@gmail.com" rel="subscribe-email" title="subscribe via email">Email</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:yorzi.github.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul role=main-navigation>
  <li><a href="/">blog</a></li>
  <li><a href="http://about.me/wangyaodi">about me</a></li>
  <li><a href="http://wangyaodi.com" style="color:red">@yorzi</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2009/11/11/cheat-sheet-in-terminal/">Cheat Sheet in Terminal</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-11-11T00:00:00+08:00" pubdate data-updated="true">Nov 11<span>th</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I found a cool gem called &#8220;cheat&#8221;, it&#8217;s pretty handy and convenient when you wanna see a brief help/introduction of some &#8220;stuff&#8221; in command line, cheat out the website for more <a href="http://cheat.errtheblog.com/b">wiki-versioned cheat sheet</a>.</p>

<blockquote>
Get started:
<i style="color:yellow">$ sudo gem install cheat
$ cheat strftime</i>

A magnificent cheat sheet for Ruby&#8217;s strftime method will be printed to your terminal.

To get some help on cheat itself:
<i style="color:yellow">$ cheat cheat</i>

How meta.

Cheat sheets are basically wiki pages accessible from the command line. You can browse, add, or edit cheat sheets. Try to keep them concise. For a style guide, check out the cheat cheat sheet.

To access a cheat sheet, simply pass the program the desired sheet&#8217;s name:
<i style="color:yellow">$ cheat <sheet name></i>
</blockquote>


<p>Reference : <a href="http://cheat.errtheblog.com/">CLICK HERE</a>!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2009/11/09/rails-best-practices/">Rails Best Practices</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-11-09T00:00:00+08:00" pubdate data-updated="true">Nov 9<span>th</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Quote from Gary&#8217;s weekly code review post, thanks to Gary Zhang.</p>

<blockquote>
all advises on Ruby on Rails code:

    * Lesson 1. Move code from Controller to Model
      1. Move finder to named_scope
      2. Use model association
      3. Use scope access
      4. Add model virtual attribute
      5. Use model callback
      6. Replace Complex Creation with Factory Method
      7. Move Model Logic into the Model
      8. model.collection_model_ids (many-to-many)
      9. Nested Model Forms (one-to-one)
      10. Nested Model Forms (one-to-many)

    * Lesson 2. RESTful Conventions
      1. Overuse route customizations
      2. Needless deep nesting
      3. Not use default route

    * Lesson 3. Model
      1. Keep Finders on Their Own Model
      2. Love named_scope # same as Move finder to named_scope
      3. the Law of Demeter
      4. DRY: metaprogramming
      5. Extract into Module
      6. Extract to composed class
      7. Use Observer

    * Lesson 4. Migration
      1. Isolating Seed Data
      2. Always add DB index

    * Lesson 5. Controller
      1. Use before_filter
      2. DRY Controller

    * Lesson 6. View
      1. Move code into controller
      2. Move code into model
      3. Move code into helper
      4. Replace instance variable with local variable
      5. Use Form Builder
      6. Organize Helper files

I think all these advises are very useful for our farther refactor on our system.

There is a very cool gem to check code according these advises(Sources : <a href="http://github.com/flyerhzm/rails_best_practices">Rails Best Practices</a>)

install:
sudo gem install rails_best_practices &#8211;source http://gemcutter.org

usage:
in rails rails app, run &#8220;rails_best_practices .&#8221; (don&#8217;t forget the parameter: &#8220;.&#8221;)
</blockquote>


<p>Not try this tool yet, but it looks really handy.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2009/11/06/mysql-dump/">Mysql Dump</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-11-06T00:00:00+08:00" pubdate data-updated="true">Nov 6<span>th</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I&#8217;m a little shamed that I ask Sonic for a mysql dump command several times, I rarely dump db myself, that&#8217;s why I forget the way dealing with it.. Ok, the commands are:</p>

<pre name="code" class="mysql">
mysqldump -u root user_production > user_production.sql
bzip2 user_production.sql

scp from server to local.

bunzip2 user_production.sql.bz2
bzcat user_production.sql.bz2 | mysql -u root user_production
or extracts the backup files, to create db directly.
</pre>


<p>Thanks Sonic.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2009/11/04/a-discussion-on-testing/">A Discussion on Testing</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-11-04T00:00:00+08:00" pubdate data-updated="true">Nov 4<span>th</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>In this week code review meeting, I open a discussion about testing code of Ruby on Rails. Actually I think the test for a complex system is not that easy if you wanna do it gracefully, but it&#8217;s still worth starting in small steps, that&#8217;s what&#8217;s important. I&#8217;d like to share the ideas people contributed, and the included contents are as following:
Andy:</p>

<blockquote>
Tried something new for RoR testing yesterday, it&#8217;s factory_girl(fixtures replacement solution. <a href='http://github.com/thoughtbot/factory_girl'>see more details</a>). In this week code review, I show the testing code, and also have questions about test:

1. How to make sure that you test all(99.5%) situations.
2. If you test before you code, how to control/ensure the function points properly?

feel free to comment here if you have any thoughts on it.
</blockquote>


<p>I commented in front:</p>

<blockquote>
My understanding of TEST:
It means we should &#8220;program&#8221;(with mock and stub) one more time in different rule(based on the testing framework) to make sure features working correctly. but there is still a big chance to make mistake in both side(twice programming), so non-structured testing does not work very well. idea?
</blockquote>


<p>Then Guolei&#8217;s view point:</p>

<blockquote>
I don&#8217;t think writing test code is &#8220;twice programming&#8221;.
1. Test code should be very plain and very simple. Mock and stub do make it complex, but there&#8217;s rarely case requiring mock and stub. If you find your test code is more complex that function code, then you are going wrong way.
2. Actually writing test code can not be called &#8220;program&#8221;. It&#8217;s more like you are telling computer what it should do. It&#8217;s from the aspect of business logic, non with technique. So you should never make mistake when you get familiar with it, even so, it takes no time to fix it.
3. The value of test code shines when refactoring code and for complex logic. I think Andy&#8217;s code is not a good example because the logic is so simple that there&#8217;s more test code than function code.
</blockquote>


<p>Gary&#8217;s sample:</p>

<blockquote>
Your test code is for a process. I would rather test a method one time, I this case I can try all possible input and test.
for example:
</blockquote>


<pre name="code" class="ruby">
describe "article?" do
    it "should figure out the page is article type" do
      2.times do
        @page.page_parts.create
      end
      @page.article?.should == true
    end
    it "should figure out the page is not article type" do
      2.times do
        @page.page_parts.create(:group_id => 0)
      end
      @page.article?.should == false
    end
  end
</pre>


<p>Then I posted:</p>

<blockquote>
Yeah.. I don&#8217;t doubt about the value of writing test code, and I totally agree on what GL mentioned should be the basic principle of adding test code.

The problem is, when I wanna cover all the situations/cases, there is, so far, no good way than writing lots of cases for it. so how to ensure it covering all the test-needed points, specially the business logic?
It&#8217;s not something about which skills(mock and stub) should be used somehow, it&#8217;s about what should be test and how to make sure you fully test what you want to test.

For example in my test code, how to ensure it can fully test the Item model? if I missed points, is this test still believable? I know surely it should cover all situations as what we want, but how to make the coverage happened correctly? The test code may save my time and energy when refactoring or doing enhancement, but if it&#8217;s not that correctly covering the case, does it still play an important role?

I am a bit confused of the way we are testing the system rather than writing test code for specific function, any more ideas?
</blockquote>


<p>JP&#8217;s response followed up:</p>

<blockquote>
As previously mentioned, I think its best to look at tests as a future investment, not a &#8220;I cover every point&#8221;. There are two types of &#8220;future investment&#8221;

1. Immediate future. You are about to write some code (function) and you know how you want it to work and what the different possibilities are. You write the test code first and then code the function. Now, as you code the function, it is much faster to see if it works (this is especially true for complex logic like the content inputting system).

2. Further future. You have a list of &#8220;known&#8221; situations/cases. You might modify the working code in the future and in the future you might forget what all these different situations/cases are - but you know what they are right now. So, you write test code. Now, if you modify the code in the future and the tests still pass, you can feel comfortable that the code you modified did not break any &#8220;known&#8221; conditions.
In both cases tests cannot find &#8220;unknown&#8221; cases&#8230;and I don&#8217;t think this is the point.

Two specific cases come to mind where I felt I used test code really well:
a) Immediate Future: When first starting the Erlang queue system I wrote a number of test cases to simulate the trainer client&#8217;s various conditions. This allowed me to write the erlang code and then run a bunch of cases on it really quickly which saved a lot of time (otherwise I would have had to do lots and lots of clicks on the Trainer Client). Unfortunately, once the queue system started integrating all of the other apps and connecting to FS I could no longer find a reasonable way to keep these test cases to work (as so many things would have to be stubbed).

a) Further future: The old, old carb.rb model. This was incredibly complex (even from the beginning). I wrote test code after writing that model. Then, a few months later, made significant changes to that model but was able to use that test code to insure I covered all the conditions (this was before Andy started working on it).
</blockquote>


<p>Seven&#8217;s response:</p>

<blockquote>
I&#8217;m only on the first step of writing test code, but it do helps me free my hands and ears from testing calls with FreeSWITCH. Nice.
</blockquote>


<p>My last response:</p>

<blockquote>
I think I got what I want from above discussion, thanks to all for sharing your view points or samples.
</blockquote>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2009/11/03/ssh-turnl-script/">SSH Tunnel Script</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-11-03T00:00:00+08:00" pubdate data-updated="true">Nov 3<span>rd</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Why SSH tunneling?</p>

<p>Obviously, if you live in Chxna or some other place where you are restricted to access free network, and if you luckily own a ssh accessible account on a server that is hosted in a free country, congratulations, you can use ssh tunnel to fuck the wall.</p>

<p>Seriously, you just need to install ssh tool on your PC, (it will be much easier to setup a ssh tunnel if you are using a *nix OS), putty is a good choose if you are on Windows. I will show the script to explain what you should do on Ubuntu 9.04.</p>

<pre name="code" class="ruby">
   ssh -qTfnN -D LocalPort remotehost(dreamhost)
</pre>


<p><code>
All the added options are for a ssh session that’s used for tunneling.
-q :- be very quite, we are acting only as a tunnel.
-T :- Do not allocate a pseudo tty, we are only acting a tunnel.
-f :- move the ssh process to background, as we don’t want to interact with this ssh session directly.
-N :- Do not execute remote command.
-n :- redirect standard input to /dev/null.
In addition on a slow line you can gain performance by enabling compression with the -C option.
</code>
 Enjoy it.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2009/11/03/polymorphic-association-in-factory_girl/">Polymorphic Association in Factory_girl</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-11-03T00:00:00+08:00" pubdate data-updated="true">Nov 3<span>rd</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I tried factroy_girl yesterday to work with rspec framework, It&#8217;s excellent way to support testing, however, the polymorphic association in factroy_girl almost defeated me.
The factory definition in my code is as:</p>

<pre name='code' class='ruby'>
Factory.define :item do |i|
    i.status 0
    i.related_with_id 1
    i.association :unit
end

Factory.define :study_record do |sr|
    sr.association :content, :factory => :item
    sr.add_attribute :interaction_id
    sr.add_attribute :finished_at
end
</pre>


<p>Then I did this:</p>

<pre name="code" class="ruby">

    @item = Factory(:item)
    @study_record = Factory(:study_record)
    @item.study_records << @study_record

</pre>


<p>But actually, this does not work to associate @study_record with @item, the problem is that @study_record.content is totally a new instance of Item rather than @item. It seems that &#8220;&lt;&lt;&#8221; doesn&#8217;t work in this case.
The right way to do so:</p>

<pre name="code" class="ruby">

     @item = Factory(:item)
    @study_record = Factory(:study_record, :content => @item)

</pre>


<p>Polymorphic association works, and it&#8217;s better than the fixtures solution indeed.</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/blog/page/7/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <img src="https://img.skitch.com/20110814-rrw7uufrh7wc6eugk6yf4163qb.jpg"></img>
  <p>Hi, I&#8217;m <b style="color:red">Andy Wang</b>.<br />
     I live in <b style="color:red">Xi&#8217;an</b>, China. <br />
     I&#8217;m a <b style="color:red">Sr. Ruby/Rails Engineer</b> at <a href="http://intridea.com">Intridea</a>.</p>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/2012/10/23/run-a-static-personal-website-on-heroku-for-free/">Run static website on Heroku for Free</a>
      </li>
    
      <li class="post">
        <a href="/2011/08/14/now-my-blog-is-running-on-octopress/">Now My Blog Is Running on Octopress</a>
      </li>
    
      <li class="post">
        <a href="/2011/06/14/riding-on-rails3-with-full-stack-of-gems/">Riding on Rails3 with full stack of Gems</a>
      </li>
    
      <li class="post">
        <a href="/2011/03/21/weekly-updates-javascript-rocks/">Weekly Updates : Javascript Rocks!</a>
      </li>
    
      <li class="post">
        <a href="/2011/03/09/settimeout-and-setinterval/">JS note: setTimeout and setInterval</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/yorzi">@yorzi</a> on GitHub
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'yorzi',
            count: 4,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("yorzi", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/yorzi" class="twitter-follow-button" data-show-count="false">Follow @yorzi</a>
  
</section>


<section class="googleplus">
  <h1>
    <a href="https://plus.google.com/108320517625960982177?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>



  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2012 - Andy Wang -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'andywangshome';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
