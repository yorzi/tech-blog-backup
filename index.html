
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>@yorzi</title>
  <meta name="author" content="Andy Wang">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  

  <link rel="canonical" href="http://tech.wangyaodi.com/index.html"/>
  <link href="/favicon.png" rel="shortcut icon" />
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="http://s3.amazonaws.com/ender-js/jeesh.min.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  
  <link href="/atom.xml" rel="alternate" title="@yorzi" type="application/atom+xml"/>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-17239385-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


  
  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>


  
  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>


  <!--Fonts from Google's Web font directory at http://google.com/webfonts -->
<link href='http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic' rel='stylesheet' type='text/css'>

</head>

<body  >
  <header><hgroup>
  <h1><a href="/" style="color:red">@yorzi</a></h1>
  
    <h2>great people share knowledge</h2>
  
  <a href="https://github.com/yorzi/site_engine"><img style="position: absolute; top: 0; right: 0; border: 0;" src="/images/forkme.png" alt="Fork me on GitHub"></a>
</hgroup>

</header>
  <nav role=navigation><ul role=subscription data-subscription="rss email">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
    <li><a href="wangyaodi@gmail.com" rel="subscribe-email" title="subscribe via email">Email</a></li>
  
</ul>
<form action="http://google.com/search" method="get">
  <fieldset role="site-search">
    <input type="hidden" name="q" value="site:tech.wangyaodi.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
<ul role=main-navigation>
  <li><a href="http://blog.wangyaodi.com">Blog</a></li>
  <li><a href="http://about.me/wangyaodi">About Me</a></li>
  <li><a href="https://plus.google.com/108320517625960982177/about?hl=en" style="color:red">@yorzi</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">



  <article>
    
  <header>
    
      <h1 class="entry-title"><a href="/2013/07/05/build-a-widget/">Build a Widget</a></h1>
    
    
      <p class="meta">




<time datetime="2013-07-05 16:08:00 +0800" pubdate  updated >Jul 5<span>th</span>, 2013</time>


</p>
    
  </header>


  <div class="entry-content"><p>Some thoughts and resources on building a widget for a specific web page or web page section.</p>

<h4>#1</h4>

<p>Use Iframe directly, it&#8217;s able to pass in some params to get needed charts.</p>

<h4>#2</h4>

<p>Wrap the iframe via a JS widget(interface), then embed a JS file with params.</p>

<h4>#3</h4>

<p>window.postMessage on modern browsers <br />
<a href="http://stackoverflow.com/questions/3457391/how-do-you-use-window-postmessage-across-domains">http://stackoverflow.com/questions/3457391/how-do-you-use-window-postmessage-across-domains</a></p>

<p>Related SlideShare:</p>

<iframe src="http://www.slideshare.net/slideshow/embed_code/13789187" width="427" height="356" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" style="border:1px solid #CCC;border-width:1px 1px 0;margin-bottom:5px" allowfullscreen webkitallowfullscreen mozallowfullscreen> </iframe>


<p> <div style="margin-bottom:5px"> <strong> <a href="http://www.slideshare.net/linkibol/external-javascript-widget-development-best-practices" title="External JavaScript Widget Development Best Practices" target="_blank">External JavaScript Widget Development Best Practices</a> </strong> from <strong><a href="http://www.slideshare.net/linkibol" target="_blank">linkibol LLC</a></strong> </div></p>

<iframe src="http://www.slideshare.net/slideshow/embed_code/5466665" width="427" height="356" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" style="border:1px solid #CCC;border-width:1px 1px 0;margin-bottom:5px" allowfullscreen webkitallowfullscreen mozallowfullscreen> </iframe>


<p> <div style="margin-bottom:5px"> <strong> <a href="http://www.slideshare.net/benvinegar/building-distributed-java-script-widgets-sat" title="Building Distributed JavaScript Widgets with jQuery" target="_blank">Building Distributed JavaScript Widgets with jQuery</a> </strong> from <strong><a href="http://www.slideshare.net/benvinegar" target="_blank">benvinegar</a></strong> </div></p>
</div>
  <footer>
    <a rel="full-article" href="/2013/07/05/build-a-widget/">Read on &rarr;</a>
  </footer>


  </article>


  <article>
    
  <header>
    
      <h1 class="entry-title"><a href="/2013/06/07/tricks-and-tips-of-deploying-rails4-app-to-heroku/">Tricks and Tips of Deploying Rails4 App to Heroku</a></h1>
    
    
      <p class="meta">




<time datetime="2013-06-07 23:01:00 +0800" pubdate  updated >Jun 7<span>th</span>, 2013</time>


</p>
    
  </header>


  <div class="entry-content"><p>Recently, I deployed a client project to Heroku and made the Heroku instance as an internal demo server. The project is based on Ruby2.0 and Rails4, unexpectedly, the deployment to Heroku is not as smooth as before. Below I&#8217;d like to share some tricks and tips that I came across.</p>

<h5>Rails4 Specific Tricks</h5>

<ul>
<li>Heroku forces you to specify your ruby version in Gemfile, it&#8217;s supported by bundler from <a href="http://gembundler.com/v1.2/whats_new.html">1.2 version</a>, so just add below line into your Gemfile:</li>
</ul>


<p>&#8220;`</p>

<h1>specify ruby version to enable the deploy to Heroku instance.</h1>

<p>ruby &#8216;2.0.0&#8217;
&#8220;`</p>

<ul>
<li>Rails4 gets rid of plugin system. In order to use features such as static asset serving and logging on Heroku, you should add the following gems to your Gemfile:</li>
</ul>


<p><code>
gem 'rails_log_stdout',           github: 'Heroku/rails_log_stdout'
gem 'rails3_serve_static_assets', github: 'Heroku/rails3_serve_static_assets'
</code></p>

<ul>
<li>Use <a href="http://puma.io/">puma</a> as the web server, you want to add a <code>Procfile</code> file and add below line in it:</li>
</ul>


<p><code>
web: bundle exec puma -p $PORT
</code></p>

<ul>
<li>Below http basic auth doesn&#8217;t work as what I did before for non-rails4 app on Heroku.</li>
</ul>


<p><code>
config.middleware.insert_after(::Rack::Lock, "::Rack::Auth::Basic", "Production") do |u, p|
  [u, p] == [USER, PASSWORD]
end
</code>
&#8220;`</p>

<h1>Error message when pushing to Heroku&#8230;</h1>

<p>&#8212;&#8211;> Preparing app for Rails asset pipeline</p>

<pre><code>   Running: rake assets:precompile
   rake aborted!
   No such middleware to insert after: Rack::Lock
</code></pre>

<p>&#8220;`</p>

<ul>
<li>Actually, Rails4 is thread safe by default, you do not have the overhead of including the <code>Rack::Lock</code> middleware in each request. So just use <code>Rack::Auth::Basic</code> directly as there is no Rack::Lock middleware any more when you using a web server such as <code>puma</code>:</li>
</ul>


<p><code>
config.middleware.use '::Rack::Auth::Basic' do |u, p|
  [u, p] == [USER, PASSWORD]
end
</code></p>

<h5>Heroku Related Tips</h5>

<p>In my case, I need to transfer PG database between local and Heroku. Firstly, I need to find the URL to my db on Heroku:</p>

<p><code>
$ heroku config:get DATABASE_URL
postgres://bla:sth@ec2-17-21-12-11.compute-1.amazonaws.com:5432/123
</code></p>

<p>Then transfer from the Heroku db to your local db (switch -t <code>to</code> and -f <code>from</code> versus):</p>

<p><code>
$ heroku plugins:install https://github.com/ddollar/heroku-pg-transfer
$ heroku pg:transfer -t postgres://localhost/dbname -f postgres://bla:sth@ec2-17-21-12-11.compute-1.amazonaws.com:5432/123
</code></p>

<p>Since the <a href="https://github.com/ddollar/heroku-pg-transfer">heroku-pg-transfer</a> tool utilizes postgres&#8217;s native pg_dump facility it is a much more predictable and resilient tool. Check out a related blog <a href="http://www.ryandaigle.com/a/pgtransfer-is-the-new-taps">for more details</a>.</p>

<p>There is another needs in my case, I have to deploy <code>development</code> branch to Heroku, but Heroku default is to deploy master branch to their instance, use below command to specify a branch for deployment.</p>

<p>&#8220;`</p>

<h1>deploy a specific branch to Heroku</h1>

<p>git push heroku other-barnch:master
&#8220;`</p>

<h4>Resources</h4>

<p><a href="https://devcenter.heroku.com/articles/rails4">https://devcenter.heroku.com/articles/rails4</a><br />
<a href="http://blog.remarkablelabs.com/2012/12/rails-4-is-thread-safe-by-default-rails-4-countdown-to-2013">http://blog.remarkablelabs.com/2012/12/rails-4-is-thread-safe-by-default-rails-4-countdown-to-2013</a><br /></p>
</div>
  <footer>
    <a rel="full-article" href="/2013/06/07/tricks-and-tips-of-deploying-rails4-app-to-heroku/">Read on &rarr;</a>
  </footer>


  </article>


  <article>
    
  <header>
    
      <h1 class="entry-title"><a href="/2013/05/23/install-jenkins-and-set-up-jenkins-ci-for-rails-projects/">Install Jenkins and Set Up Jenkins CI for Rails Projects</a></h1>
    
    
      <p class="meta">




<time datetime="2013-05-23 14:33:00 +0800" pubdate  updated >May 23<span>rd</span>, 2013</time>


</p>
    
  </header>


  <div class="entry-content"><p><a href="https://travis-ci.org/">Travis CI</a> is a great solution for OpenSource project, however, what if you want to setup an internal CI server for private projects? Believe or not, <a href="http://jenkins-ci.org/">Jenkins CI</a> is the choice. This post will guide you through the Jenkins installation and configuration on VPS (e.g. EC2 instance in this post)</p>

<h3>OS Assumption</h3>

<p>Assume that you are running an EC2 instance with a Ubuntu system as below:</p>

<p><code>
Ubuntu 12.04.2 LTS (GNU/Linux 3.2.0-40-virtual x86_64)
</code></p>

<p>BTW, there is an Amazon <a href="http://aws.amazon.com/ec2/pricing/">free tier</a> that is recommended if you don&#8217;t have any VPS to use yet.</p>

<h3>Install Rails Environment</h3>

<p>As we mainly use this Jenkins CI server for Rails projects, so necessary Ruby/Rails libs and tools are needed as following:</p>

<h5>- Install RVM and Ruby</h5>

<p>We need to have git core and curl for <a href="https://rvm.io/">RVM</a> installation, so install them like this:</p>

<p><code>
sudo apt-get install build-essential git-core
sudo apt-get install curl
</code></p>

<p>And install <a href="https://rvm.io/">RVM</a> with ruby as user <code>jenkins</code>:</p>

<p>&#8220;`</p>

<h1>remember to switch to user <code>jenkins</code> first</h1>

<p>sudo su jenkins</p>

<p>curl -L https://get.rvm.io | bash -s stable &#8211;ruby
sudo apt-get install libmysqlclient-dev ruby-dev
&#8220;`</p>

<h5>- Install Possible Databases</h5>

<h6><strong>MySQL</strong></h6>

<p><code>
sudo apt-get install mysql-client mysql-server libmysql-ruby libmysqlclient-dev
</code></p>

<h6>Postgres</h6>

<p><code>
sudo aptitude install libpq-dev
sudo apt-get install postgresql
sudo apt-get install postgresql-client
</code></p>

<p>If you had a problem with UTF-8 take a look at <a href="http://wiki.gentoo.org/wiki/PostgreSQL">http://wiki.gentoo.org/wiki/PostgreSQL</a></p>

<h6>MongoDB</h6>

<p><code>
sudo apt-key adv --keyserver keyserver.ubuntu.com --recv 7F0CEB10
echo 'deb http://downloads-distro.mongodb.org/repo/ubuntu-upstart dist 10gen' | sudo tee /etc/apt/sources.list.d/10gen.list
sudo apt-get update
sudo apt-get install mongodb-10gen
</code></p>

<h3>Install Jenkins</h3>

<p>Installation:</p>

<p><code>
wget -q -O - http://pkg.jenkins-ci.org/debian/jenkins-ci.org.key | sudo apt-key add -
sudo sh -c 'echo deb http://pkg.jenkins-ci.org/debian binary/ &gt; /etc/apt/sources.list.d/jenkins.list'
sudo aptitude update
sudo aptitude install jenkins
</code></p>

<p>Uninstall Jenkins is easy too, just:</p>

<p><code>
sudo apt-get remove jenkins
</code></p>

<p>There is also detailed <a href="https://wiki.jenkins-ci.org/display/JENKINS/Installing+Jenkins+on+Ubuntu">guide</a> for installing Jenkins on Ubuntu. FYI.</p>

<h3>Run Jenkins on Port 80</h3>

<p>Default Jenkins runs on port 8080, you need to reverse proxy port 80 to port 8080 for Jenkins, it makes the CI server public to the world. To install nginx, open terminal and type in:</p>

<p><code>
sudo apt-get install nginx
sudo /etc/init.d/nginx start
</code></p>

<p>In order to Open up the config file in vim, and update it.</p>

<p><code>
sudo vim /etc/nginx/nginx.conf
</code></p>

<p>&#8220;`
http {</p>

<pre><code>    # ...Omitted Parts…

    include /etc/nginx/conf.d/*.conf;    # This line not modified.
    include /etc/nginx/sites-enabled/*;  # This line not modified.

    ##
    # Reverse proxy port 80 to port 8080 for Jenkins
    ##
    server {
            listen 80 default;
            server_name your.domain.com;
            location /{
                    proxy_pass http://127.0.0.1:8080;
            }
    }
</code></pre>

<p>}
&#8220;`</p>

<p><strong>Notice:</strong> Jenkins shows build histories and other information, to keep the whole CI server private, you&#8217;d better use <a href="https://gist.github.com/yorzi/5590462">this guide</a> to add basic auth for your Jenkins CI, it is strongly recommended.</p>

<h3>Install valuable plugins for Jenkins</h3>

<p>Well, after above installations are done, you are able to visit your Jenkins CI server with your domain. Now it&#8217;s time to install below plugins from <code>JenkinsPlugin &gt; Manager</code> section:</p>

<ul>
<li><a href="http://wiki.jenkins-ci.org/display/JENKINS/Github+OAuth+Plugin">Github Authentication plugin</a> is used for github OAuth. (This plugin has a bug that you can not logout some times.)</li>
<li><a href="https://wiki.jenkins-ci.org/display/JENKINS/GitHub+Plugin">GitHub Plugin</a> integrates Jenkins with Github projects.</li>
<li><a href="http://wiki.jenkins-ci.org/display/JENKINS/Gravatar+Plugin]">Jenkins Gravatar plugin</a> is used for showing Gravatar avatar images for Jenkins users.</li>
<li><a href="https://wiki.jenkins-ci.org/display/JENKINS/RVM+Plugin">RVM Plugin</a> runs your jobs in the RVM managed ruby+gemset of your choice.</li>
<li><a href="https://wiki.jenkins-ci.org/display/JENKINS/Rake+Plugin">Rake plugin</a> allows Jenkins to invoke Rake tasks as build steps.</li>
<li><a href="https://wiki.jenkins-ci.org/display/JENKINS/All+Changes+Plugin">All Changes Plugin</a> shows all changes which influenced the builds of a project.</li>
</ul>


<p>For more plugins, you should check out the <a href="https://wiki.jenkins-ci.org/display/JENKINS/Plugins">Jenkins Plugins Document</a>.</p>

<h3>References &amp; Resources</h3>

<p><a href="https://wiki.jenkins-ci.org/display/JENKINS/Configuring+a+Rails+build">https://wiki.jenkins-ci.org/display/JENKINS/Configuring+a+Rails+build</a><br />
<a href="http://aptobits.com/2012/09/setting-up-jenkins-ci-on-an-amazon-ec2-linux-instance/">http://aptobits.com/2012/09/setting-up-jenkins-ci-on-an-amazon-ec2-linux-instance/</a><br />
<a href="http://watirmelon.com/2011/08/29/running-your-watir-webdriver-tests-in-the-cloud-for-free/">http://watirmelon.com/2011/08/29/running-your-watir-webdriver-tests-in-the-cloud-for-free/</a><br />
<a href="http://gistflow.com/posts/492-jenkins-ci-setup-for-rails-application-from-scratch">http://gistflow.com/posts/492-jenkins-ci-setup-for-rails-application-from-scratch</a><br />
<a href="http://blogs.burnsidedigital.com/2013/01/setting-jenkins-ci-server-for-rails-project-on-a-vagrant-box/">http://blogs.burnsidedigital.com/2013/01/setting-jenkins-ci-server-for-rails-project-on-a-vagrant-box/</a></p>

<p><strong>NOTICE:</strong> This is a blog I wrote for Intridea, I also post it here for my own reference. You are able to check out the <a href="http://www.intridea.com/blog/2013/5/21/howto-install-setup-jenkins-ci-for-rails-projects">original post</a>.</p>
</div>
  <footer>
    <a rel="full-article" href="/2013/05/23/install-jenkins-and-set-up-jenkins-ci-for-rails-projects/">Read on &rarr;</a>
  </footer>


  </article>


  <article>
    
  <header>
    
      <h1 class="entry-title"><a href="/2013/04/27/map_basics_for_noob/">Map Basics for Noob</a></h1>
    
    
      <p class="meta">




<time datetime="2013-04-27 21:40:00 +0800" pubdate  updated >Apr 27<span>th</span>, 2013</time>


</p>
    
  </header>


  <div class="entry-content"><p>A slider that I shared when Intrdea TeaHour.</p>

<iframe src="http://www.slideshare.net/slideshow/embed_code/19540019" width="427" height="356" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" style="border:1px solid #CCC;border-width:1px 1px 0;margin-bottom:5px" allowfullscreen webkitallowfullscreen mozallowfullscreen> </iframe>


<p> <div style="margin-bottom:5px"> <strong> <a href="http://www.slideshare.net/yorzi/map-basics-for-noob" title="Map Basics For Noob" target="_blank">Map Basics For Noob</a> </strong> from <strong><a href="http://www.slideshare.net/yorzi" target="_blank">Andy Wang</a></strong> </div></p>
</div>
  <footer>
    <a rel="full-article" href="/2013/04/27/map_basics_for_noob/">Read on &rarr;</a>
  </footer>


  </article>


  <article>
    
  <header>
    
      <h1 class="entry-title"><a href="/2013/01/19/downloadable-svg-in-png-format/">Downloadable SVG in PNG Format</a></h1>
    
    
      <p class="meta">




<time datetime="2013-01-19 16:08:00 +0800" pubdate  updated >Jan 19<span>th</span>, 2013</time>


</p>
    
  </header>


  <div class="entry-content"><p>Recently, I worked on some interesting features, we use <a href="http://www.highcharts.com/">Highcharts</a> and/or <a href="http://raphaeljs.com/">Raphaeljs</a> to build complex charts, including bar chart, scatter chart or heat map, etc. In an extreme sample, we build a complicated one-page charting engine by which user is able to compose a group of conditions and then render a meaningful chart according to what are selected. It&#8217;s pretty cool.</p>

<p>Meanwhile, client is willing to download these generated charts on individual chart level. They also want to have an ability to share the individual chart as a link or even as a piece of HTML code. What&#8217;s the best solution to add these functionalities? Well, we did try many solutions for the features, let me show you how we make it finally.</p>

<h4>Start from a HTML template</h4>

<script src="https://gist.github.com/4443672.js"></script>


<p>Above HTML code is the generated content on my page, I will mainly explain the solution based on it. Here is also a sample SVG file: <a href="https://gist.github.com/4443811">sample.svg</a>, you can use it to go through the whole senario if you want to experiment by yourself.</p>

<h4>Deal with SVG via HTML5 Canvas</h4>

<p>HighCharts and Rapheal are JS libaries by which you are able to generate complex <a href="http://www.w3.org/TR/SVG11/">SVG</a> charts, normally, people can not download a svg file directly, and it&#8217;s also not a popular image format for sharing around. We&#8217;d better convert it to a PNG or JPG image, as PNG and JPG format is downloadable from web page. I will take PNG format as a sample in this post.</p>

<p>How to convert a SVG image to a PNG image? Mainly, you can do the convertion job from server side. There is a SVG toolkit provided by Apache which is named as <a href="http://xmlgraphics.apache.org/batik/#download">Batik</a>. But I don&#8217;t like this solution, it&#8217;s a bit comoplex to install Batik and make it work with Ruby on Rails. I&#8217;d like to work the convertion out via pure javascript. Yes, use <a href="http://code.google.com/p/canvg/">canvg</a> to move all SVG information to a HTML5 Canvas object.</p>

<script src="https://gist.github.com/4452589.js"></script>


<p>Using the HTML5 canvas element, you can create all sorts of cool graphics client-side on the fly using Javascript. There is a neat function on the the canvas object called toDataURL(). This functions encodes the image data as a base64 encoded PNG file and returns it as a <a href="http://en.wikipedia.org/wiki/Data:_URI_scheme">data: URI</a>. By using the data:URI string, you can make it a downloadable PNG file.</p>

<p>There is also a libary to help you do so, it&#8217;s <a href="http://www.nihilogic.dk/labs/canvas2image/">Canvas2Image</a> that can convert canvas to image as BMP, PNG or JPEG format.</p>

<script src="https://gist.github.com/4467012.js"></script>


<p></p>

<h4>Customize default filename while downloading</h4>

<p>Canvas2Image lib will implement a pop out window to allow you download the data:URI as a PNG image file with a default name <code>download</code>, which is not acceptable by our client, I have to figure out a way to customize the downloadable filename.</p>

<script src="https://gist.github.com/4467156.js"></script>


<p>It might be easy if you just want to cover your Chrome or Firefox user, as there is a <code>download</code> attribute for <code>&lt;a&gt;</code> tag, when you set it as something like <code>&lt;a src='the data:uri string' download='test.png'&gt;</code> then you will get the default filename in this the case when you click the download link.</p>

<p>I am not lucky, I have to cover IE9 at least. So I need to push the data:uri to server, then I can render the data with specific headers(see below code), that will make the downloadable file with a customized file name.</p>

<script src="https://gist.github.com/4467051.js"></script>


<p>Pay attention to above <code>html2canvas([$(".hidden_container")[0]],{ … })</code> parts. It helps to convert whole HTML code to a canvas based on <a href="http://html2canvas.hertzen.com/">html2canvas</a> lib, that&#8217;s our case as we have to wrap up some HTML code out side the the charts.</p>

<h4>A trick to overcome IE9 issue</h4>

<p>When you work on IE9, the canvg fails to translate the SVG to Canvas, it seems IE9&#8217;s <code>DOMParser()</code> is not able to parse the SVG successfully. After some search from Google, we found only one line code will resove the SVG parser issue. Just replace some invalid string in SVG data as below:</p>

<script src="https://gist.github.com/4467165.js"></script>


<h4>Conclusion</h4>

<p>To summarize this post, you are suggested to use several JS libs above to convert <code>SVG</code> to <code>Canvas</code>, then convert <code>Canvas</code> to <code>PNG</code> file, if you also want to customize a piece of HTML code out side the SVG chart, then you are able to convert <code>HTML</code> to <code>Canvas</code>, then again from <code>Canvas</code> to <code>PNG</code>, when you want to set a customized filename for the generated PNG file, you have to send the data:uri string onto server side, then rewrite the response headers, all these handling will implement a downloading feature for you.</p>
</div>
  <footer>
    <a rel="full-article" href="/2013/01/19/downloadable-svg-in-png-format/">Read on &rarr;</a>
  </footer>


  </article>


  <article>
    
  <header>
    
      <h1 class="entry-title"><a href="/2012/10/22/run-a-static-website-on-heroku-for-free/">Run a Static Website on Heroku for Free</a></h1>
    
    
      <p class="meta">




<time datetime="2012-10-22 20:00:00 +0800" pubdate  updated >Oct 22<span>nd</span>, 2012</time>


</p>
    
  </header>


  <div class="entry-content"><div class="thumbnail"><a href="http://wangyaodi.com"><img src="https://img.skitch.com/20121023-fxqkstawwd56ehbpecxq6ifkq8.preview.jpg" alt="Andy Wang - Professional Ruby on Rails Engineer, Senior Web Application Developer." /></a><br /><span>Uploaded with <a href="http://skitch.com">Skitch</a>!</span></div>


<p>Recently, I plan to update my personal information on internet, I also plan to have a professional personal website on which I can show my introduction, skills and working experiences. I guess it will introduce me to the world in a cool way.</p>

<p>Well, first of all, I bought an awesome template on <a href="https://wrapbootstrap.com/">wrapbootstrap</a>, where all pretty templates are built on <a href="http://twitter.github.com/bootstrap/">Twitter&#8217;s BootStrap</a>, I guess everyone loves BootStrap, who doesn&#8217;t?</p>

<p>Once I get the simple static HTML template for website, I am going to deploy it to Heroku for free. We know <a href="http://heroku.com">Heroku</a> deliveries their popular cloud hosting for <a href="http://rubyonrails.org/">Ruby on Rails</a>, <a href="http://nodejs.org/">Node.js</a> and other framework. How does it work for static HTML website hosting?</p>

<p>I found that, we actually can build s simple Rack application to <code>run</code> the static website on heroku. But how? See below:</p>

<ul>
<li>Add <code>Gemfile</code> to require the <code>rack</code> gem for the website.</li>
</ul>


<p><code>
source 'http://rubygems.org'
gem 'rack'
</code></p>

<ul>
<li>Add <code>config.ru</code> file in root folder of the website, this will enable the Rack handlings.</li>
</ul>


<p>&#8220;`
$stdout.sync = true</p>

<p>use Rack::Static,
  :urls => [&#8220;/font-awesome&#8221;, &#8220;/js&#8221;, &#8220;/img&#8221;, &#8220;/style&#8221;],
  :root => &#8220;.&#8221;</p>

<p>run lambda { |env|
  [</p>

<pre><code>200,
{
  'Content-Type'  =&gt; 'text/html',
  'Cache-Control' =&gt; 'public, max-age=86400'
},
File.open('index.html', File::RDONLY)
</code></pre>

<p>  ]
}
<code>``
- Add</code>Procfile` in root folder to config the heroku web server and worker(if there is any).</p>

<p><code>
web: bundle exec rackup -p $PORT
</code></p>

<p>Ok, now it&#8217;s ready to deploy the whole website to Heroku, <a href="https://devcenter.heroku.com/articles/git">here</a> is a detailed document that can help you to deploy a codebase to Heroku. Meanwhile, you are allow to customize your domain for any app running on Heroku, <a href="https://devcenter.heroku.com/articles/custom-domains">here</a> is also a docment for this purpose on heroku help center.</p>

<p>Easy, right? I&#8217;ve run my awesome personal website on <a href="wangyaodi.com">wangyaodi.com</a> according to above steps, give it a look if you are interested in it. You are also welcomed to fork its <a href="https://github.com/yorzi/cv-andywang">source code</a> on github. Enjoy it!</p>
</div>
  <footer>
    <a rel="full-article" href="/2012/10/22/run-a-static-website-on-heroku-for-free/">Read on &rarr;</a>
  </footer>


  </article>


  <article>
    
  <header>
    
      <h1 class="entry-title"><a href="/2011/08/14/now-my-blog-is-running-on-octopress/">Now My Blog Is Running on Octopress</a></h1>
    
    
      <p class="meta">




<time datetime="2011-08-14 19:39:00 +0800" pubdate  updated >Aug 14<span>th</span>, 2011</time>


</p>
    
  </header>


  <div class="entry-content"><p><img src="https://img.skitch.com/20110814-m6jxiyu37ygd2pgxwfejamf95g.jpg" alt="Octopress" /></p>

<p>Octopress is owesome!</p>

<p>Last time I tried to migrate my wordpress blog to <a href="https://github.com/mojombo/jekyll">Jekyll</a>, then I failed to find some beautiful theme. And when <a href="cn.intridea.com">intridea cn blog</a> was built using <a href="https://github.com/ddfreyne/nanoc">nanoc</a>, I&#8217;d like to give it try, you know, I still gave nanoc up as I can not make the theme pretty by myself.</p>

<p>Days ago, I came across the <a href="http://www.octopress.org">octopress</a>, I totally fell in love with its convenience and cool blog theme. I spent several hours to move my blog to github this afternoon. Oh my, Now I can write blogs in Markdown and deploy it to github.</p>

<p>Octopress has its official website with many valuable materials to help you get start and doing other regarding interesting things. Cool, hah? Try it out now!</p>
</div>
  <footer>
    <a rel="full-article" href="/2011/08/14/now-my-blog-is-running-on-octopress/">Read on &rarr;</a>
  </footer>


  </article>


  <article>
    
  <header>
    
      <h1 class="entry-title"><a href="/2011/06/14/riding-on-rails3-with-full-stack-of-gems/">Riding on Rails3 With Full Stack of Gems</a></h1>
    
    
      <p class="meta">




<time datetime="2011-06-14 00:00:00 +0800" pubdate  updated >Jun 14<span>th</span>, 2011</time>


</p>
    
  </header>


  <div class="entry-content"><p><strong>NOTICE:</strong> Below post was released a month ago on <a href="http://intridea.com/2011/5/13/rails3-gems">Intridea Company Blog</a>, also post here as a backup.</p>

<p>It&#8217;s been close to a year since Rails3 came out. Luckily, I&#8217;ve worked on several Rails3 projects after it&#8217;s released, so I&#8217;d like to share a stack of gems that I used in my previous projects. I guess they will give people a bit help while developing a new Rails3 app.</p>

<p>I don&#8217;t want to explain too much on these gems separately, well, most of the gems have good documents on their project wiki(every great gem should be well documented, right?). Instead, I just add regarding links to their repos so that you&#8217;d better take a further look while you really use it. In order to introduce the lists of gems clearly, I simply categorized them based on a rough structure.</p>

<p>Ok, here we start:</p>

<h4><strong>&raquo; Authentication</strong></h4>




<blockquote>
  <ul>
  <li>OmniAuth (<a href="https://github.com/intridea/omniauth">https://github.com/intridea/omniauth</a>)</li>
  <li>Devise (<a href="https://github.com/plataformatec/devise">https://github.com/plataformatec/devise</a>)</li>
  </ul>
</blockquote>


<p>The above two are really amazing gems to speed up your authentication. Yes, I love both of them in different cases: ideally OmniAuth is better for applications which want to support multi-provider external authentication, so I&#8217;ve just added OmniAuth into RefactorMyCode Rails3 branch to take its auth benefits; Devise is totally powerful enough for classic authentication case. However, if you have too much your own business logic inside your login/registration/auth flow, you definitely need to make your own authentication.</p>

<h4><strong>&raquo; Access Control</strong></h4>




<blockquote>
  <ul>
  <li>CanCan (<a href="https://github.com/ryanb/cancan">https://github.com/ryanb/cancan</a>)</li>
  <li>declarative_authorization (<a href="https://github.com/stffn/declarative_authorization">https://github.com/stffn/declarative_authorization</a>)</li>
  </ul>
</blockquote>


<p><a href="https://github.com/ryanb">Ryan</a> is a star in Rails world, so his CanCan is really popular, which aims to do neat but powerful authorization. However, the declarative_autharization is also an option, actually, Ryan mentioned CanCan was inspired by declarative_autharization.</p>

<h4><strong>&raquo; Views/Page and Admin Scaffold</strong></h4>




<blockquote>
  <ul>
  <li>compass (<a href="https://github.com/chriseppstein/compass">https://github.com/chriseppstein/compass</a>)</li>
  <li>haml (<a href="https://github.com/nex3/haml">https://github.com/nex3/haml</a>)</li>
  <li>sanitize (<a href="https://github.com/rgrove/sanitize">https://github.com/rgrove/sanitize</a>)</li>
  <li>rails_admin (<a href="https://github.com/sferik/rails_admin">https://github.com/sferik/rails_admin</a>)</li>
  <li>web-app-theme (<a href="https://github.com/andreferraro/web-app-theme">https://github.com/andreferraro/web-app-theme</a>)</li>
  </ul>
</blockquote>


<p>From a front-end perspective, I suggest you might need to try above gems to speed up and simplify your UI designing. For example on the admin section, it&#8217;d be great if you can apply your CRUD quickly to pages, that&#8217;s what rails_admin does. Surely, these gems won&#8217;t end all your UI problems, but it really helps when you doing prototype or being lack of some real designers.</p>

<h4><strong>&raquo; Quick SNS</strong></h4>




<blockquote>
  <ul>
  <li>acts-as-taggable-on (<a href="https://github.com/mbleigh/acts-as-taggable-on">https://github.com/mbleigh/acts-as-taggable-on</a>)</li>
  <li>has_friends-rails3 (<a href="https://github.com/rrouse/has_friends">https://github.com/rrouse/has_friends</a>)</li>
  <li>acts_as_favable (<a href="https://github.com/yorzi/acts_as_favable">https://github.com/yorzi/acts_as_favable</a>)</li>
  <li>thumbs_up (<a href="https://github.com/brady8/thumbs_up">https://github.com/brady8/thumbs_up</a>)</li>
  <li>acts_as_commentable (<a href="https://github.com/jackdempsey/acts_as_commentable">https://github.com/jackdempsey/acts_as_commentable</a>)</li>
  <li>profanity_filter (<a href="https://github.com/intridea/profanity_filter">https://github.com/intridea/profanity_filter</a>)</li>
  </ul>
</blockquote>


<p>Well, I don&#8217;t mean a whole solution of SNS or regarding feature, here theses gems can help you add the basic cross-object function rapidly, it increases your confidence to focus on designing over programming at the very beginning. Here I want to give a simple introduction to <strong>acts_as_favable</strong>, it allows for favorites refer to be added to multiple and different models.</p>

<h4><strong>&raquo; Form and Related Tools</strong></h4>




<blockquote>
  <ul>
  <li>simple_form (<a href="https://github.com/plataformatec/simple_form">https://github.com/plataformatec/simple_form</a>)</li>
  <li>formtastic (<a href="https://github.com/justinfrench/formtastic">https://github.com/justinfrench/formtastic</a>)</li>
  <li>formtastic_datepicker_inputs (<a href="https://github.com/demersus/formtastic_datepicker_inputs">https://github.com/demersus/formtastic_datepicker_inputs</a>)</li>
  <li>tiny_mce (<a href="https://github.com/kete/tiny_mce">https://github.com/kete/tiny_mce</a>)</li>
  <li>paperclip (<a href="https://github.com/thoughtbot/paperclip">https://github.com/thoughtbot/paperclip</a>)</li>
  <li>carrierwave (<a href="https://github.com/jnicklas/carrierwave">https://github.com/jnicklas/carrierwave</a>)</li>
  </ul>
</blockquote>


<p>Most of above gems are famous through &lt;railscasts.com> created by Ryan. There are two pairs of options here: <strong>simple_form</strong> and <strong>formtastic</strong> / <strong>paperclip</strong> and <strong>carrierwave</strong>. I like all these solutions, you should pick up one to fit your project, if you want to know differences between each pair, get more details on their wiki :) Tiny is an HUGE gem for rich editing, I list it here to remind its exist, but I recommend you  get the WYSWYG via some JS lib like <a href="http://premiumsoftware.net/cleditor">CLEditor</a>, it works gracefully.</p>

<h4><strong>&raquo; Searching Solutions</strong></h4>




<blockquote>
  <ul>
  <li>meta_seach (<a href="https://github.com/ernie/meta_search">https://github.com/ernie/meta_search</a>)</li>
  <li>meta_where (<a href="https://github.com/ernie/meta_where">https://github.com/ernie/meta_where</a>)</li>
  <li>thinking-sphinx (<a href="https://github.com/freelancing-god/thinking-sphinx">https://github.com/freelancing-god/thinking-sphinx</a>)</li>
  <li>acts_at_indexed (<a href="https://github.com/dougal/acts_as_indexed">https://github.com/dougal/acts_as_indexed</a>)</li>
  <li>sunspot (<a href="https://github.com/outoftime/sunspot">https://github.com/outoftime/sunspot</a>)</li>
  </ul>
</blockquote>


<p>Talking about searching in rails, I think you have many words to say. Here I wanna roughly split these gems into two types: Object-based searching and Full-Text searching. I heavily recommend you use meta_search and/or meta_where as your model based searching, it can convert your form params directly to a search solution, that&#8217;s convenient. Full-Test searching depends on your case, but all these three gems(thinking-sphinx, acts_as_indexed, sunspot) are great.</p>

<h4><strong>&raquo; Pagination</strong></h4>




<blockquote>
  <ul>
  <li>kaminari (<a href="https://github.com/amatsuda/kaminari">https://github.com/amatsuda/kaminari</a>)</li>
  <li>kaminari_themes (<a href="https://github.com/amatsuda/kaminari_themes">https://github.com/amatsuda/kaminari_themes</a>)</li>
  </ul>
</blockquote>


<p>No more will_paginate in Rails3, absolutely, the only option is kaminari.</p>

<h4><strong>&raquo; Background Work</strong></h4>




<blockquote>
  <ul>
  <li>delayed_job (<a href="https://github.com/collectiveidea/delayed_job">https://github.com/collectiveidea/delayed_job</a>)</li>
  <li>resque (<a href="https://github.com/defunkt/resque">https://github.com/defunkt/resque</a>)</li>
  </ul>
</blockquote>


<p>There is one post to introduce resque clearly <a href="https://github.com/blog/542-introducing-resque">here</a>, in that post, github staff mentioned their brief history of doing background jobs, so I think you can understand well the differences between delayed_job and resque solution.</p>

<h4><strong>&raquo; Status Machine</strong></h4>




<blockquote>
  <ul>
  <li>workflow (<a href="https://github.com/ryan-allen/workflow">https://github.com/ryan-allen/workflow</a>)</li>
  <li>state_machine (<a href="https://github.com/pluginaweek/state_machine">https://github.com/pluginaweek/state_machine</a>)</li>
  </ul>
</blockquote>


<p>I like to use workflow a bit more, since it&#8217;s much natural to me, you definitely need one status machine to control your stable flow stuff, such as a registration flow status or a wizard-like features.</p>

<h4><strong>&raquo; Rack API framework</strong></h4>




<blockquote>
  <ul>
  <li>grape (<a href="https://github.com/intridea/grape">https://github.com/intridea/grape</a>)</li>
  </ul>
</blockquote>


<p>This gem is for adding API to Rails/Sinatra application. <a href="http://intridea.com/about/people/mbleigh">Michael</a> gave people an awesome <a href="http://confreaks.net/videos/475-rubyconf2010-the-grapes-of-rapid">speech in RubyConf2010</a> on his Grape, here I suggest you should watch it to know more details about GRAPE. I believe you will fall in love with it.</p>

<h4><strong>&raquo; Memcached Client</strong></h4>




<blockquote>
  <ul>
  <li>memcache-client (<a href="https://github.com/mperham/memcache-client">https://github.com/mperham/memcache-client</a>)</li>
  <li>dalli (<a href="https://github.com/mperham/dalli">https://github.com/mperham/dalli</a>)</li>
  </ul>
</blockquote>


<p>These two gems are actually mainly written by one same author <em><a href="https://github.com/mperham">Mike Perham</a></em>, he mentioned that <em>Dalli is a high performance pure Ruby client for accessing memcached servers. It works with memcached 1.4+ only as it uses the newer binary protocol. It should be considered a replacement for the memcache-client gem. The API tries to be mostly compatible with memcache-client with the goal being to make it a drop-in replacement for Rails.</em></p>

<h4><strong>&raquo; Deployment and Monitor</strong></h4>




<blockquote>
  <ul>
  <li>capistrano (<a href="https://github.com/capistrano/capistrano">https://github.com/capistrano/capistrano</a>)</li>
  <li>cap-recipes (<a href="https://github.com/nesquena/cap-recipes">https://github.com/nesquena/cap-recipes</a>)</li>
  <li>god (<a href="https://github.com/mojombo/god">https://github.com/mojombo/god</a>)</li>
  </ul>
</blockquote>


<p>I am not a system administrator, so every time talking about the regarding aspects will make me feel silly, I just try to describe tools which can help me out on unfamiliar area, that&#8217;s not bad, at least people like me, will do deployment and monitor quickly based on these gems, they do help.</p>

<h4><strong>&raquo; Cron job and Backup as a Pro</strong></h4>




<blockquote>
  <ul>
  <li>whenever (<a href="https://github.com/javan/whenever">https://github.com/javan/whenever</a>)</li>
  <li>backup (<a href="https://github.com/meskyanichi/backup">https://github.com/meskyanichi/backup</a>)</li>
  </ul>
</blockquote>


<p>Above two gems are my favorites, before knowing these two gems, I have to write complex and stupid scripts to do backups that I am not familiar with. Cron job is also a pain in ass if you are not a system administrator. Now time changes, you, as a ruby programmer, can do the corn job and backup in ruby way, surely as a PRO. :)</p>

<h4><strong>&raquo; Testing Gracefully</strong></h4>




<blockquote>
  <ul>
  <li>rspec-rails (<a href="https://github.com/dchelimsky/rspec-rails">https://github.com/dchelimsky/rspec-rails</a>)</li>
  <li>factory_girl_rails (<a href="https://github.com/thoughtbot/factory_girl_rails">https://github.com/thoughtbot/factory_girl_rails</a>)</li>
  <li>faker (<a href="https://github.com/yyyc514/faker">https://github.com/yyyc514/faker</a>)</li>
  <li>watchr (<a href="https://github.com/mynyml/watchr">https://github.com/mynyml/watchr</a>)</li>
  <li>autowatchr (<a href="https://github.com/viking/autowatchr">https://github.com/viking/autowatchr</a>)</li>
  <li>database_cleaner (<a href="https://github.com/bmabey/database_cleaner">https://github.com/bmabey/database_cleaner</a>)</li>
  <li>mail_safe (<a href="https://github.com/myronmarston/mail_safe">https://github.com/myronmarston/mail_safe</a>)</li>
  </ul>
</blockquote>


<p>Testing is always important, I know TDD and BDD are getting more and more popular, that means you have to own your super gun to make it happen. Right, here is a list of gems which can help you out, I didn&#8217;t cover all different levels of testing with these gems. Point is, rspec is my favorite framework for testing, <strong>factory_girl</strong> and <strong>faker</strong> are good supports. Anyway, test by your way.</p>

<h4><strong>&raquo; Toolkit</strong></h4>




<blockquote>
  <ul>
  <li>ruby-debug (<a href="https://github.com/mark-moseley/ruby-debug">https://github.com/mark-moseley/ruby-debug</a>)</li>
  <li>hirb (<a href="https://github.com/cldwalker/hirb">https://github.com/cldwalker/hirb</a>)</li>
  <li>cheat (<a href="https://github.com/defunkt/cheat">https://github.com/defunkt/cheat</a>)</li>
  <li>rails-settings-cached (https://github.com/huacnlee/rails-settings-cached)</li>
  </ul>
</blockquote>


<p>There are many handy gems which will give you convenience and power. Take above four as examples, ruby-debuy gives you a chance to check your running applications&#8217; context at specific program point; hirb display your AR items in table view in console; cheat makes your terminal working as a pool of other gems&#8217; manual; rails-settings-cached is for global configurations in Rails3 application. Yeah, throwing the brick out is to meet your GEMS.</p>

<h3><strong>How to find great gems?</strong></h3>


<p>First, you need to follow up Ryan&#8217;s <a href="railscasts.com">railscasts</a>, he is good at introducing new stuff in video. Second, you can go through great open source project&#8217;s <strong>Gemfile</strong>, yeah, it&#8217;s definitely the best way to come across valuable gems. Third, just subscribe <a href="https://github.com/languages/Ruby">github ruby trends</a> to know what&#8217;s going on in Ruby/Rails community. There are also some other involving sites, like <a href="rubygems.org">rubygems</a> and <a href="railsplugins.org">railsplugins</a>, you should take a glance when you free, I bet you will find useful gems.</p>

<p>It&#8217;s nearly the end of this post, this topic was originally shared with all Intridea China Team members during last Friday Teahour. You can find the PPT <a href="http://www.slideshare.net/yorzi/riding-on-rails3-with-full-stack-of-gems">here</a>. To share with more people, I turn it into this blog, I must miss many valuable gems in this list, so please comment your thoughts.</p>
</div>
  <footer>
    <a rel="full-article" href="/2011/06/14/riding-on-rails3-with-full-stack-of-gems/">Read on &rarr;</a>
  </footer>


  </article>


  <article>
    
  <header>
    
      <h1 class="entry-title"><a href="/2011/03/21/weekly-updates-javascript-rocks/">Weekly Updates : Javascript Rocks!</a></h1>
    
    
      <p class="meta">




<time datetime="2011-03-21 00:00:00 +0800" pubdate  updated >Mar 21<span>st</span>, 2011</time>


</p>
    
  </header>


  <div class="entry-content"><p>After quit from Idapted/Eleutian, I&#8217;d like to have a long term plan for writing blogs. However, as everything starts, it&#8217;s always hard. I thought it around, and finally decided to open my mind, and just try to start with a strong belief : Sharing! Then an idea comes out.</p>

<p>First of all, I think my weekly updates will help to share great things I came across or even I started to use, it has much fun to replay all these stuff, so I will do that in the weekend, that&#8217;s also part of my study review.</p>

<p>Ok, turn to the points:</p>

<ol>
<li>Now you must know <a href="http://www.javascriptlint.com/index.htm">JSLint</a>. JSlint is a Javascript checker, which can help you ensure your JS&#8217; quality. There are many great open source projects helping you to program in Javascript.</li>
</ol>


<p>Sources:
Github Proj: <a href="https://github.com/douglascrockford/JSLint">https://github.com/douglascrockford/JSLint</a>
Add JSLint to you TextMate: <a href="https://github.com/subtleGradient/javascript-tools.tmbundle">https://github.com/subtleGradient/javascript-tools.tmbundle</a></p>

<ol>
<li><p>Are you familiar with <a href="http://en.wikipedia.org/wiki/Behavior_Driven_Development">BDD</a>? You should start to learn it now if you did not have a change to give it a try. Specially, if you are using Ruby/Ruby on Rails, I strongly recommend you try <a href="http://rspec.info/">rSpec</a> for the BDD. Back to the topic, I wanna share with you some similar BDD way in programming Javascript, <a href="https://github.com/visionmedia/jspec">jspec</a> and <a href="http://pivotal.github.com/jasmine/">Jasmine</a>, obviously, they are cool. I just mention this as a reminder people who want to try interesting programming. I didn&#8217;t try them yet, but I guess I will do that in soon.</p></li>
<li><p>JS in real-time application <a href="http://nodejs.org/">Node.js</a> and <a href="https://github.com/Flotype/now">NowJS</a></p></li>
<li><p>Books to speed you up!
•  Javascript: The Good Parts (<a href="http://oreilly.com/catalog/9780596517748">http://oreilly.com/catalog/9780596517748</a>)
•  JavaScript Patterns (<a href="http://oreilly.com/catalog/9780596806767/">http://oreilly.com/catalog/9780596806767/</a>)
•  High Performance JavaScript (<a href="http://oreilly.com/catalog/9780596802806/">http://oreilly.com/catalog/9780596802806/</a>)</p></li>
</ol>


<p>Javascript is a long journey, I am just on the start point. Anyway, exciting!</p>
</div>
  <footer>
    <a rel="full-article" href="/2011/03/21/weekly-updates-javascript-rocks/">Read on &rarr;</a>
  </footer>


  </article>


  <article>
    
  <header>
    
      <h1 class="entry-title"><a href="/2011/03/09/settimeout-and-setinterval/">JS Note: setTimeout and setInterval</a></h1>
    
    
      <p class="meta">




<time datetime="2011-03-09 00:00:00 +0800" pubdate  updated >Mar 9<span>th</span>, 2011</time>


</p>
    
  </header>


  <div class="entry-content"><p>Yesterday, I discussed a JS issue with <a href="http://www.yakjuly.com/">Blade</a>, that I have to set up an automatic photo-switch effect on an existing page. I don&#8217;t want to change anything except adding a piece of javascript for doing that job because this page is already messy up by another engineer. Blade suggested I should use <strong><a href="https://developer.mozilla.org/en/DOM/window.setTimeout">setTimeout</a></strong> for this effect.</p>

<h4><strong>* Case Study</strong></h4>


<p>The basic case is something like below(there are some other effects based on the structure and style, so don&#8217;t affect others):
<code lang='html'></p>

<div id="tab_ls">
        <a class="active" id="haikou"></a>
    <a id="dalian"></a>  
        <a id="changsha"></a> 
</div>




<div id="tab_con">
    <div style="display: block;" id="fk">   
        <div id="end"></div>
        <div id="ctt">
            <img src="http://www.2011roadshow.com/images/haikou.jpg">
                    <h3>会议城市：海口</h3>
            <p>时间：8月26日 14：00-18：00</p>
                    <p>地点：海口鑫源温泉大酒店</p>
        </div>
    </div>
        
    <div id="fk" style="display:none">
        <div id="end"></div>
            <div id="ctt">
            <img src="http://www.2011roadshow.com/images/dalian.jpg">
                    <h3>会议城市：大连</h3>
            <p>时间：9月3日 14：00-18：00</p>
                    <p>地点：香洲花园酒店 </p>
        </div>
    </div>

    <div id="fk" style="display:none">
        <div id="end"></div>
            <div id="ctt">
            <img src="images/changsha.jpg">
                    <h3>城市：长沙</h3>
            <p>时间：9月4日 14：00-18：00</p>
                    <p>地点：长沙潇湘华天大酒店</p>
        </div>
    </div>
</div>


<p></code>
Now the task is to write a js to roll the cities and regarding images, how to make it happen?</p>

<h4>* Solution with <strong>setTimeout</strong></h4>


<p><code lang='javascript'></p>

<script type="text/javascript">
    var cities;
    var cityImages;
    var currentCity;
    var pause = false;
    var timer1;
    var timer2 ;
    
    function showNextImage()
    {           
        if (pause) {
            // do nothing
        } else {
            console.log("show next image");
            console.log(currentCity);
            if(cities.last() == currentCity) {
                currentCity = currentCity.first();
            } else {
                currentCity = currentCity.next();
            }
            console.log(currentCity);
            
            var index = cities.index(currentCity);
            console.log(index);
            cityImages.hide();
            console.log(cityImages.get(index));
            $(cityImages.get(index)).show();
            cities.removeClass("active")
            currentCity.addClass("active");
        }
        timer1 = window.setTimeout("showNextImage()", 2000);
    }
    
    function repeatPlay()
    {   
        console.log("repeat play");
        showNextImage();
        if (timer2 != null){
            clearTimeout(timer2);
            timer2 = null;
        }
    }

  $(window).load(function(){
    cities = $("#tab_ls a");
    cityImages = $("#tab_con div#fk");
    currentCity = cities.first()
    console.log(cities);
    console.log("window load");
    repeatPlay();
    $("#tab_ls a").click(function(){
                clearTimeout(timer1);
        timer1 = null;
            timer2 = window.setTimeout("repeatPlay()", 6000);
    });
  });
</script>


<p></code>
Actually, you can figure out this effect with <strong><a href="https://developer.mozilla.org/en/window.setInterval">setInterval</a></strong> as well. The difference between setTimeout and setInterval is how many times you want to run the function which is set as their parameters. setTimeout will execute the function only once when time is out. But setInterval execute the function repeatedly in certain interval which is set as a parameter.</p>

<p>Every time you should remember to clear the Timeout or Interval after finish your job through <strong><a href="https://developer.mozilla.org/en/DOM/window.clearTimeout">clearTimeout</a></strong> and <strong><a href="https://developer.mozilla.org/en/DOM/window.clearInterval">clearInterval</a></strong>.</p>

<p>I have linked the regarding references for the four methods about, you should read the document and related samples to know more details.</p>

<p>More Resources:
<a href="http://hi.baidu.com/ruhaole/blog/item/af905fefc2dad33aadafd57a.html">如何在jQuery中使用 setInterval，setTimeout</a>
<a href="http://cn.dydou.cn/wyzz/2010/0710/13733.html">jQuery：Tab切换功能的集合</a></p>
</div>
  <footer>
    <a rel="full-article" href="/2011/03/09/settimeout-and-setinterval/">Read on &rarr;</a>
  </footer>


  </article>

<nav role="pagination">
  <div>
    
      <a class="prev" href="/page2/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
  </div>
</nav>

<script type="text/javascript">
    var disqus_shortname = 'refactoringthoughts';
    (function () {
      var s = document.createElement('script'); s.async = true;
      s.type = 'text/javascript';
      s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
      (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>

</div>
<aside role=sidebar>
  
    <section>
  <img src="https://img.skitch.com/20110814-rrw7uufrh7wc6eugk6yf4163qb.jpg"></img>
  <p>Hi, I&#8217;m <b style="color:red">Andy Wang</b>.<br />
     I live in <b style="color:red">Beijing</b>, China. <br />
     I&#8217;m a <b style="color:red">Sr. Ruby/Rails Engineer</b> at <a href="http://intridea.com">Intridea</a>.</p>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/2013/07/05/build-a-widget/">Build A Widget</a>
      </li>
    
      <li class="post">
        <a href="/2013/06/07/tricks-and-tips-of-deploying-rails4-app-to-heroku/">Tricks and Tips of Deploying Rails4 App to Heroku</a>
      </li>
    
      <li class="post">
        <a href="/2013/05/23/install-jenkins-and-set-up-jenkins-ci-for-rails-projects/">Install Jenkins and Set Up Jenkins CI for Rails Projects</a>
      </li>
    
      <li class="post">
        <a href="/2013/04/27/map_basics_for_noob/">Map basics for noob</a>
      </li>
    
      <li class="post">
        <a href="/2013/01/19/downloadable-svg-in-png-format/">Downloadable SVG in PNG Format</a>
      </li>
    
      <li class="post">
        <a href="/2012/10/22/run-a-static-website-on-heroku-for-free/">Run a Static Website on Heroku for Free</a>
      </li>
    
      <li class="post">
        <a href="/2011/08/14/now-my-blog-is-running-on-octopress/">Now My Blog Is Running on Octopress</a>
      </li>
    
      <li class="post">
        <a href="/2011/06/14/riding-on-rails3-with-full-stack-of-gems/">Riding on Rails3 with full stack of Gems</a>
      </li>
    
  </ul>
  <p>>>>>>>>>  <a style="color:red" href="/blog/archives">More Posts in Archives</a></p>
</section>

<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("yorzi", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/yorzi" class="twitter-follow-button" data-width="208px" data-show-count="false">Follow @yorzi</a>
  
</section>


<section>
  <h1>On Delicious</h1>
  <script type="text/javascript" src="http://feeds.delicious.com/v2/js/yorzi?title=&count=3&sort=date&extended"></script>
  <p><a href="http://delicious.com/yorzi">My Delicious Bookmarks &raquo;</a></p>
</section>


  
</aside>

    </div>
  </div>
  <footer><p>
  Copyright &copy; 2013 - Andy Wang -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
</body>
</html>
